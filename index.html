<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—é†’ç‹® - å²­å—æ–‡åŒ–å…ƒå®‡å®™</title>
    <!-- æ ·å¼ -->
    <style>
        :root {
            --primary-red: #C23B23;  /* å²­å—çº¢ */
            --lion-gold: #F5D300;    /* é†’ç‹®é»„ */
            --dark-bg: #1A1A1A;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: var(--dark-bg);
            color: white;
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header {
            background: linear-gradient(to right, var(--primary-red), #8B0000);
            padding: 1rem;
            text-align: center;
        }

        /* ARå®¹å™¨ */
        #ar-viewer {
            width: 100%;
            height: 60vh;
            border: 3px solid var(--lion-gold);
            border-radius: 15px;
            margin: 2rem 0;
        }

        /* NFTå¡ç‰‡ */
        .nft-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem;
            transition: transform 0.3s;
        }

        .nft-card:hover {
            transform: translateY(-5px);
        }

        /* å“åº”å¼å¸ƒå±€ */
        @media (max-width: 768px) {
            #ar-controls button {
                width: 100%;
                margin: 0.5rem 0;
            }
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <header class="header">
        <h1>ğŸ¦ æ•°å­—é†’ç‹®</h1>
        <p>ä½“éªŒå²­å—éé—çš„å…ƒå®‡å®™ä¹‹æ—…</p>
    </header>

    <!-- ARä½“éªŒåŒº -->
    <section class="container">
        <div id="ar-viewer">
            <!-- WebXR å†…å®¹å°†åœ¨æ­¤æ¸²æŸ“ -->
            <model-viewer 
                src="models/lion_high.glb"
                ar 
                camera-controls 
                auto-rotate
                style="width: 100%; height: 100%;">
            </model-viewer>
        </div>
        
        <!-- ARæ§åˆ¶æŒ‰é’® -->
        <div id="ar-controls">
            <button onclick="startAR()" class="ar-button">
                ğŸš€ å¯åŠ¨ARä½“éªŒ
            </button>
            <button onclick="toggleAnimation('dance')">
                ğŸ’ƒ èˆç‹®è¡¨æ¼”
            </button>
        </div>
    </section>

    <!-- NFTé“¸é€ åŒº -->
    <section class="container">
        <h2>ğŸ é¢†å–ä½ çš„æ•°å­—é†’ç‹®</h2>
        <div class="nft-form">
            <select id="lion-style">
                <option value="foshan">ä½›å±±é†’ç‹®</option>
                <option value="chaozhou">æ½®å·é†’ç‹®</option>
            </select>
            <input type="color" id="lion-color" value="#F5D300">
            <button onclick="mintNFT()">ğŸª™ é“¸é€ NFT</button>
        </div>
        
        <!-- NFTå±•ç¤º -->
        <div id="nft-gallery" class="grid"></div>
    </section>

    <!-- æ–‡åŒ–ä¼ æ‰¿åŒº -->
    <section class="culture-section">
        <article>
            <h2>ğŸ“œ é†’ç‹®æ–‡åŒ–</h2>
            <video controls poster="poster.jpg">
                <source src="culture/lion_dance.mp4" type="video/mp4">
            </video>
            <p>å¹¿åºœé†’ç‹®èµ·æºäº...ï¼ˆæ–‡åŒ–ä»‹ç»æ–‡æœ¬ï¼‰</p>
        </article>
    </section>

    <!-- è„šæœ¬ -->
    <script type="module">
        // åŠ è½½ARæ¨¡å‹
        import { ModelViewerElement } from 'https://unpkg.com/@google/model-viewer';

        // ARå¯åŠ¨å‡½æ•°
        async function startAR() {
            try {
                const modelViewer = document.querySelector('model-viewer');
                const session = await modelViewer.activateAR();
                session.addEventListener('select', () => toggleAnimation());
            } catch (error) {
                alert('è¯·ä½¿ç”¨æ”¯æŒARçš„ç§»åŠ¨è®¾å¤‡è®¿é—®');
            }
        }

        // NFTé“¸é€ å‡½æ•°
        async function mintNFT() {
            const style = document.getElementById('lion-style').value;
            const color = document.getElementById('lion-color').value;
            
            const response = await fetch('/api/lion/mint-nft', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('jwt')}`
                },
                body: JSON.stringify({
                    style: style,
                    color: color
                })
            });

            const result = await response.json();
            if(result.success) {
                displayNFT(result.nft);
            }
        }

        function displayNFT(nftData) {
            const gallery = document.getElementById('nft-gallery');
            gallery.innerHTML += `
                <div class="nft-card">
                    <h3>${nftData.name}</h3>
                    <img src="${nftData.image}" alt="æ•°å­—é†’ç‹®NFT">
                    <p>åŒºå—é“¾å“ˆå¸Œï¼š${nftData.txHash}</p>
                </div>
            `;
        }
    </script>

    <!-- æ¨¡å‹æŸ¥çœ‹å™¨ -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</body>
</html>